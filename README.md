# Плохие практики
![imgs/badpractice1.png](imgs/badpractice1.png)<br>
Команду RUN можно было вызвать один раз, добавив "\ " в конце первой строки.
Это замедляет сборку образа и увеличивает его размер.<br>
![imgs/badpractice2.png](imgs/badpractice1.png)<br>
Использование суперпользователя вместо непривилигированного пользователя
приводит к угрозам безопасности:
есть риск эксплоита контейнерного приложения
для получения доступа к управлению хостом,
и в целом использование суперпользователя - это постоянный риск
нарушения изоляции между контейнером и хостом
и потенциальные изменения в самом хосте,
так как контейнер и хост работают с общим ядром системы.<br>
![imgs/badpractice3.png](imgs/badpractice3.png)<br>
Ненужные операции замедляют сборку образа,
ухудшают читабельность кода.
В категорию подобных плохих практики
в целом входит любой излишний код и данные в Dockerfile
(будь то бесполезные команды, ненужные пакеты и т. д.)<br>
# Исправление плохих практик
![imgs/badpractice1-fixed.png](imgs/badpractice1-fixed.png)<br>
Оптимизируем размер и скорость сборки образа.<br>
![imgs/badpractice2-fixed.png](imgs/badpractice2-fixed.png)<br>
Новый пользователь ограничен и используется исключительно для образов
этого Dockerfile.<br>
![imgs/badpractice3-fixed.png](imgs/badpractice3-fixed.png)<br>
Избавляемся от бесцельных команд.<br>
# Плохие практики при использовании контейнера
![imgs/container_badpractice1.png](imgs/container_badpractice1.png)<br>
Запуск контейнера без значимого имени.<br>
![imgs/container-badpractice3.png](imgs/container-badpractice3.png)<br>
Оставление ненужных контейнеров включёнными – трата ресурсов ПК.<br>

# Задание со звездочкой!
Во втором задании нужно было поднять кластер Kubernetes, запустить наш контейнер в нём, при этом всё описано кодом. Само собой, должны быть deployment и service, а приложение, работающее внутри контейнера должно открываться локально на моем браузере. Приступаем.

## Поднимаем кластер
Поднимем мы его с помощью minicube, а в качестве драйвера будем использовать virtualbox. Ниже на рисунке показан запуск кластера с помощью команды `minikube start`.<br>
![imgs/minikube_start.png](imgs/minikube_start.png)<br>

Проверяем работоспособность нашего кластера с помощью `kubectl get componentstatuses`. Также можно заглянуть в VirtualBox и увидеть, что наш кластер работает.<br>
![imgs/minikube_check.png](imgs/minikube_check.png)<br>

## Загружаем образ в репозиторий
Кластер подняли, теперь пора загрузить образ, полученный из нашего докер файла (во всех дальнейших примерах будет использоваться "хороший" докер файл, для плохого файла все шаги те же). 
Для начала давайте получим образ из нашего файла с помощью команды `docker build`. В качестве тега установим myk8sapp.<br>
![imgs/docker_build.png](imgs/docker_build.png)<br>

В качестве репозитория будем использовать всеми любимый Docker Hub, необходимо залогинниться в него, предварительно создав публичный репозиторий. <br>
![imgs/docker_login.png](imgs/docker_login.png)<br>

Самое время запушить наш образ в созданный репозиторий с помощью команды `docker push`.<br>
![imgs/docker_push.png](imgs/docker_push.png)<br>

Готово! Теперь наш образ можно загрузить из репозитория с помощью `docker pull`.

## Описываем deployment и service 

Начнём с деплоймента. Для начала создадим файлик deployment.yaml, где опишем всю конфигурацию. Содержимое файлика представлено на скриншоте.<br>
![imgs/deployment.png](imgs/deployment.png)<br>

Из интересного в нём: будет создаваться три пода (поле replicas), в которых будут запущены контейнеры с нашим образом, открыт 5000 порт. Запустим наш deployment в кластере с помощью команды `kubectl apply`.<br>
![imgs/kuber_apply_deploy.png](imgs/kuber_apply_deploy.png)<br>
Как мы можем убедиться, наши три пода бегут, а значит всё замечательно.


Поступим аналогично и с нашим сервисом. Создаем service.yaml:<br>
![imgs/service.png](imgs/service.png)<br>

Наш сервис будет типа NodePort, чтобы все ноды были доступны на одном порте. Порт открыт 5000.
С помощью того же `kubectl apply` запускаем наш сервер и проверяем, всё ли в порядке: <br>
![imgs/check_service.png](imgs/check_service.png)<br>

Воу, все работает! Получим URL у нашего сервиса с помощью `minikube service <service_name> --url`:
![imgs/minikube_url.png](imgs/minikube_url.png)

## Открываем в бразуере
Проверим, всё ли у нас правильно: открываем браузер и переходим по полученному URL... Что мы видим? Всё работает! 
![imgs/works.png](imgs/works.png)
